// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

import (
	"github.com/google/wire"
	"github.com/rs/zerolog/log"
	"github.com/spf13/viper"
	"hc/api/packet"
	"hc/internal/connection"
	packet2 "hc/internal/packet"
	"hc/pkg/config"
	"sync"
)

// Injectors from wire.go:

func InitializeApp() *App {
	resolver := ProvideRouteResolver()
	wrapFunc := connection.ProvideMiddlewareWrapper()
	frontController := connection.ProvideFrontController(resolver, wrapFunc)
	repository := connection.ProvideSocketRepository(frontController)
	trafficParser := connection.ProvideTrafficParser()
	requestPool := connection.ProvideRequestPool()
	trafficManager := connection.ProvideTrafficManager(repository, trafficParser, requestPool)
	gameSocket := connection.ProvideGameSocket(repository, trafficManager)
	app := NewApp(gameSocket)
	return app
}

// wire.go:

var AppSet = wire.NewSet(connection.GameServerSet, ProvideRouteResolver, wire.Bind(new(packet.Resolver), new(*packet2.Resolver)), ProvideConfig)

var (
	routeResolver     *packet2.Resolver
	routeResolverOnce sync.Once
)

func ProvideRouteResolver() *packet2.Resolver {
	routeResolverOnce.Do(func() {
		routeResolver = packet2.NewResolver(CollectRoutes())
	})

	return routeResolver
}

func ProvideConfig() *viper.Viper {
	v, err := config.Build(config.WithConfigDirectory("config/"), config.WithEnvFile(".env"))

	if err != nil {
		log.Fatal().Msgf("unable to initialize config: %s", err.Error())
	}

	return v
}

func NewApp(server *connection.GameSocket) *App {
	return &App{GameServer: server}
}
